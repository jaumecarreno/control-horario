<div id="kiosk-panel">
  {% if employee %}
    <p>Empleado autenticado: <strong>{{ employee.name }}</strong></p>
    <p class="muted">Estado actual: <strong>{{ status }}</strong></p>

    <div class="kiosk-actions actions">
      <form
        method="post"
        action="{{ url_for('kiosk.kiosk_punch', action='in') }}"
        hx-post="{{ url_for('kiosk.kiosk_punch', action='in') }}"
        hx-target="#kiosk-panel"
        hx-swap="outerHTML"
      >
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button
          type="submit"
          class="kiosk-btn in{% if status == 'ENTRADA' %} is-dimmed{% endif %}"
          data-action-label="REGISTRAR ENTRADA"
          data-status="{{ status }}"
          data-should-confirm="{{ 'true' if status == 'ENTRADA' else 'false' }}"
        >
          <span class="kiosk-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M10 7L15 12L10 17" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M15 12H3" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M21 4V20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          Registrar ENTRADA
        </button>
      </form>

      <form
        method="post"
        action="{{ url_for('kiosk.kiosk_punch', action='out') }}"
        hx-post="{{ url_for('kiosk.kiosk_punch', action='out') }}"
        hx-target="#kiosk-panel"
        hx-swap="outerHTML"
      >
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button
          type="submit"
          class="kiosk-btn out{% if status == 'SALIDA' %} is-dimmed{% endif %}"
          data-action-label="REGISTRAR SALIDA"
          data-status="{{ status }}"
          data-should-confirm="{{ 'true' if status == 'SALIDA' else 'false' }}"
        >
          <span class="kiosk-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M14 7L9 12L14 17" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M9 12H21" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M3 4V20" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </span>
          Registrar SALIDA
        </button>
      </form>
    </div>

    {% if recent_events %}
      <div class="kiosk-history">
        <p><strong>Ãšltimos 5 marcajes</strong></p>
        <ul>
          {% for event in recent_events %}
            <li>
              {% if event.type.value == 'IN' %}
                Entrada - {{ event.ts.strftime("%H:%M:%S") }}
              {% else %}
                Salida - {{ event.ts.strftime("%H:%M:%S") }}
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      </div>
    {% endif %}
  {% else %}
    <p>Introduce PIN de empleado</p>
    {% if pin_error %}
      <p class="flash danger">{{ pin_error }}</p>
    {% endif %}
    <form
      method="post"
      action="{{ url_for('kiosk.kiosk_auth_pin') }}"
      hx-post="{{ url_for('kiosk.kiosk_auth_pin') }}"
      hx-target="#kiosk-panel"
      hx-swap="outerHTML"
    >
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <label for="pin">PIN</label>
      <input id="pin" name="pin" type="password" minlength="4" maxlength="16" required>
      <div style="margin-top: .8rem;">
        <button type="submit">Autenticar</button>
      </div>
    </form>
  {% endif %}
</div>
