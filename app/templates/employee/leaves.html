{% extends "base.html" %}

{% block content %}
  {% include "employee/_sections.html" %}
  <section class="card">
    <h1>Solicitudes de vacaciones y permisos</h1>
    <p class="muted">{{ employee.name }}</p>
    {% if active_shift %}
      <p class="muted" style="margin-top:-.35rem;">Turno activo: {{ active_shift.name }}</p>
    {% else %}
      <p class="muted" style="margin-top:-.35rem;">Sin turno activo.</p>
    {% endif %}
    <form method="post">
      {{ form.hidden_tag() }}
      <label for="{{ form.type_id.id }}">{{ form.type_id.label.text }}</label>
      {{ form.type_id() }}
      <label for="{{ form.date_from.id }}">Desde</label>
      {{ form.date_from() }}
      <label for="{{ form.date_to.id }}">Hasta</label>
      {{ form.date_to() }}
      <label for="{{ form.minutes.id }}">Minutos</label>
      {{ form.minutes() }}
      {% if available_policies %}
        <div style="margin-top: 1rem;">{{ form.submit() }}</div>
      {% else %}
        <p class="muted" style="margin-top:.75rem;">No hay vacaciones o permisos configurados para tu turno actual.</p>
        <div style="margin-top: 1rem;">{{ form.submit(disabled=true) }}</div>
      {% endif %}
    </form>
  </section>

  <section class="card">
    <h2>Historial</h2>
    <table>
      <thead>
        <tr>
          <th>Creada</th>
          <th>Tipo</th>
          <th>Desde</th>
          <th>Hasta</th>
          <th>Estado</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for leave_request, leave_type in rows %}
          <tr>
            <td>{{ leave_request.created_at }}</td>
            <td>{{ leave_type.code }}</td>
            <td>{{ leave_request.date_from }}</td>
            <td>{{ leave_request.date_to }}</td>
            <td>{{ leave_status_labels.get(leave_request.status, leave_request.status.value) }}</td>
            <td>
              {% if leave_request.status.value == "REQUESTED" %}
                <form class="inline" method="post" action="{{ url_for('employee.leave_cancel', leave_request_id=leave_request.id) }}">
                  <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                  <button type="submit" class="danger">Cancelar</button>
                </form>
              {% else %}
                -
              {% endif %}
            </td>
          </tr>
        {% else %}
          <tr><td colspan="6">Aun no hay solicitudes.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
{% endblock %}
