{% extends "base.html" %}

{% block content %}
  {% include "admin/_sections.html" %}
  <section class="card">
    <h1>Solicitudes pendientes</h1>
    <table>
      <thead>
        <tr>
          <th>Empleado</th>
          <th>Tipo</th>
          <th>Desde</th>
          <th>Hasta</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for leave_request, employee, leave_type in rows %}
          <tr>
            <td>{{ employee.name }}</td>
            <td>{{ leave_type.code }}</td>
            <td>{{ leave_request.date_from }}</td>
            <td>{{ leave_request.date_to }}</td>
            <td>
              <form class="inline" method="post" action="{{ url_for('admin.approval_approve', leave_request_id=leave_request.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit">Aprobar</button>
              </form>
              <form class="inline" method="post" action="{{ url_for('admin.approval_reject', leave_request_id=leave_request.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="danger">Rechazar</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="5">No hay solicitudes pendientes.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section class="card">
    <h2 style="margin-top:0;">Rectificaciones pendientes</h2>
    <table>
      <thead>
        <tr>
          <th>Empleado</th>
          <th>Fichaje original</th>
          <th>Nuevo fichaje</th>
          <th>Motivo</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for correction_request, employee, source_event in correction_rows %}
          <tr>
            <td>{{ employee.name }}</td>
            <td>{{ source_event.ts }} {{ source_event.type.value }}</td>
            <td>{{ correction_request.requested_ts }} {{ correction_request.requested_type.value }}</td>
            <td>{{ correction_request.reason }}</td>
            <td>
              <form class="inline" method="post" action="{{ url_for('admin.punch_correction_approve', correction_request_id=correction_request.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit">Aprobar</button>
              </form>
              <form class="inline" method="post" action="{{ url_for('admin.punch_correction_reject', correction_request_id=correction_request.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="danger">Rechazar</button>
              </form>
            </td>
          </tr>
        {% else %}
          <tr><td colspan="5">No hay rectificaciones pendientes.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
{% endblock %}
